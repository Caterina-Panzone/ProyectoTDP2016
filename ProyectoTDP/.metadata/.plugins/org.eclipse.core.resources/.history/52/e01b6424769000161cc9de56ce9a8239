package Tanques;

import javax.swing.ImageIcon;
import Juego.Celda;
import Juego.ObjetoConImagen;

public class Disparo extends ObjetoConImagen{

	//Atributos
	
	protected Tanque emisor;
	protected char direccion;
	
	//Constructor
	
	public Disparo(Tanque emisor, char dir, Celda celda){
		super(8,celda);
		this.emisor=emisor;
		direccion=dir;
		
		imagenes[0]= new ImageIcon(this.getClass().getResource("/Imagenes/BalaA.png"));
		imagenes[1]= new ImageIcon(this.getClass().getResource("/Imagenes/BalaB.png"));
		imagenes[2]= new ImageIcon(this.getClass().getResource("/Imagenes/BalaD.png"));
		imagenes[3]= new ImageIcon(this.getClass().getResource("/Imagenes/BalaI.png"));
		
		switch (direccion){
			case 'A': {
				cambiarImagenActual(0);
				break;
			}
			case 'B': {
				cambiarImagenActual(1);
				break;
			}
			case 'D': {
				cambiarImagenActual(2);
				break;
			}
			case 'I': {
				cambiarImagenActual(3);
				break;
			}
		}
	}
	
	//Comandos 
	
	public void destruirse(){
		//emisor.eliminarDisparo(this);
		emisor=null;
	}
	
	public void setCelda(Celda celda){
		this.celda = celda;  
	}
	
	public void avanzar(Mapa mapa){
		Disparo disparo = vieja.getBala();
		int fila = vieja.getFila(); 
		int columna = vieja.getColumna(); 
		Celda nueva = null; 
		char direccion = disparo.getDireccion(); 
		
		switch(direccion){
			case 'I':
			{
				if(columna-1>=0)
					nueva = getCelda(fila, columna-1); 
				else {
					disparo.destruirse(); 
				}
			    break; 
		    }
		case 'D': 
			{
				if(columna+1<cantidadColumnas())
					nueva = getCelda(fila, columna+1); 
				else {
					disparo.destruirse(); 
				}
				break; 
		    }
		case 'B': 
			{
				if(fila+1<cantidadFilas())
					nueva = getCelda(fila+1, columna); 
				else {
					disparo.destruirse();  
				}
				break; 
			}
		case 'A': 
			{
				if(fila-1>=0)
					nueva = getCelda(fila-1, columna); 
				else {
					disparo.destruirse();  
				}
				break; 
			}
		}
		
		vieja.setBala(null);
		
		if(nueva!=null){
			
			if(nueva.getObstaculo()!=null && nueva.getObstaculo().atraviesanDisparos()){
				if(nueva.getBala()==null){
					if(nueva.getTanque()==null){
						nueva.setBala(disparo); 
						disparo.setCelda(nueva);
					}
					else{
						disparo.getEmisor().dispareTanque(nueva.getTanque());
					}
				}
				else{
					nueva.getBala().destruirse(); 
					disparo.destruirse(); 
				}
			}
			else{
				//Ver lo de la pared de acero. 
				if(nueva.getObstaculo()!=null){
					nueva.getObstaculo().recibirGolpe();
					disparo.destruirse(); 
				}
			}
		}
	}
	
	//Consultas
	
	public Tanque getEmisor(){
		return emisor; 
	}
	
	public char getDireccion(){
		return direccion; 
	}
}
